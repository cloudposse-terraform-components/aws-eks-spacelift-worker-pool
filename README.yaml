name: "aws-eks-spacelift-worker-pool"
# Canonical GitHub repo
github_repo: "cloudposse-terraform-components/aws-eks-spacelift-worker-pool"
# Short description of this project
description: |-
  This component provisions the `WorkerPool` part of the
  [Kubernetes Operator](https://docs.spacelift.io/concepts/worker-pools/kubernetes-workers#kubernetes-workers) for
  [Spacelift Worker Pools](https://docs.spacelift.io/concepts/worker-pools#kubernetes) into an EKS cluster. You can
  provision this component multiple times to create multiple worker pools in a single EKS cluster.
usage: |-
  > [!NOTE]
  >
  > Before provisioning the `eks/spacelift-worker-pool` component, the `eks/spacelift-worker-pool-controller` component
  > must be provisioned first into an EKS cluster to enable the
  > [Spacelift Worker Pool Kubernetes Controller](https://docs.spacelift.io/concepts/worker-pools#kubernetes). The
  > `eks/spacelift-worker-pool-controller` component must be provisioned only once per EKS cluster.

  The Spacelift worker needs to pull a Docker image from an ECR repository. It will run the Terraform commands inside the
  Docker container. In the Cloud Posse reference architecture, this image is the "infra" or "infrastructure" image derived
  from [Geodesic](https://github.com/cloudposse/geodesic). The worker service account needs permission to pull the image
  from the ECR repository, and the details of where to find the image are configured in the various `ecr_*` variables.

  **Stack Level**: Regional

  ```yaml
  # stacks/catalog/eks/spacelift-worker-pool/defaults.yaml
  components:
    terraform:
      eks/spacelift-worker-pool:
        enabled: true
        name: "spacelift-worker-pool"
        space_name: root
        # aws_config_file is the path in the Docker container to the AWS_CONFIG_FILE.
        # "/etc/aws-config/aws-config-spacelift" is the usual path in the "infrastructure" image.
        aws_config_file: "/etc/aws-config/aws-config-spacelift"
        spacelift_api_endpoint: "https://yourcompany.app.spacelift.io"
        eks_component_name: "eks/cluster"
        worker_pool_size: 40
        kubernetes_namespace: "spacelift-worker-pool"
        kubernetes_service_account_enabled: true
        kubernetes_service_account_name: "spacelift-worker-pool"
        keep_successful_pods: false
        kubernetes_role_api_groups: [""]
        kubernetes_role_resources: ["*"]
        kubernetes_role_resource_names: null
        kubernetes_role_verbs: ["get", "list"]
        ecr_component_name: ecr
        ecr_environment_name: use1
        ecr_stage_name: artifacts
        ecr_tenant_name: core
        ecr_repo_name: infra
  ```
references:
  - name: Spacelift Worker Pools (Kubernetes)
    url: https://docs.spacelift.io/concepts/worker-pools#kubernetes
    description: ""
  - name: Customizing the Runner Image
    url: https://docs.spacelift.io/integrations/docker#customizing-the-runner-image
    description: ""
  - name: Worker Pool
    url: https://registry.terraform.io/providers/spacelift-io/spacelift/latest/docs/resources/worker_pool
    description: ""
  - name: Installation
    url: https://docs.spacelift.io/concepts/worker-pools#installation
    description: ""
  - name: spacelift-workerpool-controller
    url: https://github.com/spacelift-io/spacelift-helm-charts/tree/main/spacelift-workerpool-controller
    description: ""
  - name: spacelift-workerpool-controller/values.yaml
    url: https://github.com/spacelift-io/spacelift-helm-charts/blob/main/spacelift-workerpool-controller/values.yaml
    description: ""
  - name: Authentication and Configuration
    url: https://registry.terraform.io/providers/hashicorp/aws/latest/docs#authentication-and-configuration
    description: ""
  - name: aws-cli/issues/3875
    url: https://github.com/boto/botocore/issues/2245
    description: ""
tags:
  - component/eks/spacelift-worker-pool
  - layer/spacelift
  - provider/aws
  - provider/helm
  - provider/spacelift
# Categories of this project
categories:
  - component/eks/spacelift-worker-pool
  - layer/spacelift
  - provider/aws
  - provider/helm
  - provider/spacelift
# License of this project
license: "APACHE2"
# Badges to display
badges:
  - name: Latest Release
    image: https://img.shields.io/github/release/cloudposse-terraform-components/aws-eks-spacelift-worker-pool.svg?style=for-the-badge
    url: https://github.com/cloudposse-terraform-components/aws-eks-spacelift-worker-pool/releases/latest
  - name: Slack Community
    image: https://slack.cloudposse.com/for-the-badge.svg
    url: https://slack.cloudposse.com
related:
  - name: "Cloud Posse Terraform Modules"
    description: Our collection of reusable Terraform modules used by our reference architectures.
    url: "https://docs.cloudposse.com/modules/"
  - name: "Atmos"
    description: "Atmos is like docker-compose but for your infrastructure"
    url: "https://atmos.tools"
contributors: [] # If included generates contribs
